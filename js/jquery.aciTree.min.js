
/*
 * aciTree jQuery Plugin v4.2.1
 * http://acoderinsights.ro
 *
 * Copyright (c) 2013 Dragos Ursu
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Require jQuery Library >= v1.9.0 http://jquery.com
 * + aciPlugin >= v1.5.1 https://github.com/dragosu/jquery-aciPlugin
 */

// core
(function(c,b,e){var a={ajax:{url:null,dataType:"json"},dataSource:null,rootData:null,queue:{async:4,interval:50,delay:20},loaderDelay:500,expand:false,collapse:false,unique:false,empty:false,show:{props:{height:"show"},duration:"medium",easing:"linear"},animateRoot:true,hide:{props:{height:"hide"},duration:"medium",easing:"linear"},view:{duration:"medium",easing:"linear"},ajaxHook:function(g,f){f.url+=(g?this.getId(g):"")},itemHook:function(g,h,f,i){},serialize:function(f,h,g){if(typeof h=="object"){return g}else{return"|"+g}}};var d={__extend:function(){c.extend(this._instance,{locked:false,queue:new this._queue(this,this._instance.options.queue)});c.extend(this._private,{loaderHide:null,loaderInterval:null,delayBusy:0})},init:function(g){g=this._options(g);if(this.wasInit()){this._trigger(null,"wasinit",g);this._fail(null,g);return}if(this.isLocked()){this._trigger(null,"locked",g);this._fail(null,g);return}if(!this._trigger(null,"beforeinit",g)){this._trigger(null,"initfail",g);this._fail(null,g);return}this._instance.locked=true;this._instance.jQuery.addClass("aciTree"+this._instance.index).attr("role","tree").on("click"+this._instance.nameSpace,".aciTreeButton",this.proxy(function(j){var i=this.itemFrom(j.target);if(!this.isBusy(i)){this.toggle(i,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique})}})).on("mouseenter"+this._instance.nameSpace+" mouseleave"+this._instance.nameSpace,".aciTreeButton",function(j){var i=c(j.target);if(!i.hasClass("aciTreeButton")){i=i.parents(".aciTreeButton:first")}i.toggleClass("aciTreeHover",j.type=="mouseenter")}).on("mouseenter"+this._instance.nameSpace+" mouseleave"+this._instance.nameSpace,".aciTreeLine",function(j){var i=c(j.target);if(!i.hasClass("aciTreeLine")){i=i.parents(".aciTreeLine:first")}i.toggleClass("aciTreeHover",j.type=="mouseenter")});this._initHook();var h=this.proxy(function(){this._super();this._instance.locked=false;this._trigger(null,"init",g);this._success(null,g)});var f=this.proxy(function(){this._super();this._instance.locked=false;this._trigger(null,"initfail",g);this._fail(null,g)});if(this._instance.options.rootData){this.loadFrom(null,this._inner(g,{success:h,fail:f,itemData:this._instance.options.rootData}))}else{if(this._instance.options.ajax.url){this.ajaxLoad(null,this._inner(g,{success:h,fail:f}))}else{h.apply(this)}}},_initHook:function(){},isLocked:function(){return this._instance.locked},_format:function(o,g){if(!(g instanceof Array)){return o}var h=o.split(/(%[0-9]+)/gm);var p="",f,k,n=false,l;var m=new b.RegExp("^%[0-9]+$");for(var j in h){f=h[j];l=f.length;if(l){if(!n&&m.test(f)){k=b.parseInt(f.substr(1))-1;if((k>=0)&&(k<g.length)){p+=g[k];continue}}else{n=false;if(f.substr(l-1)=="%"){if(f.substr(l-2)!="%%"){n=true}f=f.substr(0,l-1)}}p+=f}}return p},_coreDOM:{leaf:function(f){f.removeClass("aciTreeInode aciTreeInodeMaybe aciTreeOpen").removeAttr("aria-expanded").addClass("aciTreeLeaf")},inode:function(f,g){f.removeClass("aciTreeLeaf").attr("aria-expanded",false).addClass(g?"aciTreeInode":"aciTreeInodeMaybe")},toggle:function(f,g){f.attr("aria-expanded",g).toggleClass("aciTreeOpen",g)}},_queue:function(h,q){var k=false;var p=[],o=[];var n=0,g=0,l=0;var j=function(){if(k){return}var r=new b.Date().getTime();if(l>r){return}var t,s=false;if(n==0){t=p.shift()}if(!t&&(g<q.async)){t=o.shift();s=true}if(t){if(s){g++;t.call(h,function(){g--})}else{n++;t.call(h,function(){if(r-l>q.interval){l=r+q.delay}n--})}}};var i=[];var f=function(){for(var r=0;r<16;r++){i[r]=b.setInterval(j,1)}};var m=function(){for(var r in i){b.clearInterval(i[r])}};f();this.init=function(){this.destroy();f();return this};this.push=function(s,r){if(!k){if(r){o.push(s)}else{p.push(s)}}return this};this.busy=function(){return(n!=0)||(g!=0)||(p.length!=0)||(o.length!=0)};this.destroy=function(){k=true;m();p=[];o=[];n=0;g=0;l=0;k=false;return this}},_task:function(f,i){var g=0,h=false;this.push=function(k,j){g++;f.push(function(l){var m=this;k.call(this,function(){l();g--;if((g<1)&&!h){h=true;i.call(m)}})},j)}},_options:function(h,j,f,i){var g=c.extend({uid:"ui",success:null,fail:null,notify:null,expand:this._instance.options.expand,collapse:this._instance.options.collapse,unique:this._instance.options.unique,unanimated:false,itemData:{}},h);if(j){if(h&&h.success){g.success=function(){j.apply(this,arguments);h.success.apply(this,arguments)}}else{g.success=j}}if(f){if(h&&h.fail){g.fail=function(){f.apply(this,arguments);h.fail.apply(this,arguments)}}else{g.fail=f}}if(i){if(h&&h.notify){g.notify=function(){i.apply(this,arguments);h.notify.apply(this,arguments)}}else{if(!g.notify&&h&&h.success){g.notify=function(){i.apply(this,arguments);h.success.apply(this,arguments)}}else{g.notify=i}}}else{if(!g.notify&&h&&h.success){g.notify=h.success}}return g},_inner:function(f,g){return c.extend({},f,{success:null,fail:null,notify:null},g)},_trigger:function(i,f,g){var h=c.Event("acitree");if(!g){g=this._options()}this._instance.jQuery.trigger(h,[this,i,f,g]);return !h.isDefaultPrevented()},_success:function(g,f){if(f&&f.success){f.success.call(this,g,f)}},_fail:function(g,f){if(f&&f.fail){f.fail.call(this,g,f)}},_notify:function(g,f){if(f&&f.notify){f.notify.call(this,g,f)}},_delayBusy:function(f,g){if((this._private.delayBusy<10)&&this.isBusy(f)){this._private.delayBusy++;b.setTimeout(this.proxy(function(){this._delayBusy.call(this,f,g);this._private.delayBusy--}),10);return}g.apply(this)},_dataSource:function(g){var i=this._instance.options.dataSource;if(i){var h=this.itemData(g);if(h&&h.source&&i[h.source]){return i[h.source]}var f;do{f=this.parent(g);h=this.itemData(f);if(h&&h.source&&i[h.source]){return i[h.source]}}while(f.length)}return this._instance.options.ajax},ajaxLoad:function(g,f){if(g&&this.isBusy(g)){this._delayBusy(g,function(){this.ajaxLoad(g,f)});return}f=this._options(f,function(){this._loading(g);this._trigger(g,"loaded",f)},function(){this._loading(g);this._trigger(g,"loadfail",f)},function(){this._loading(g);this._trigger(g,"wasloaded",f)});if(!g||this.isInode(g)){this._instance.queue.push(function(h){if(!this._trigger(g,"beforeload",f)){this._fail(g,f);h();return}this._loading(g,true);if(this.wasLoad(g)){this._notify(g,f);h();return}var i=c.extend({},this._dataSource(g));this._instance.options.ajaxHook.call(this,g,i);i.success=this.proxy(function(j){if(j&&(j instanceof Array)&&j.length){var k=function(){if(this.wasLoad(g)){this._notify(g,f);h()}else{this._createBranch(g,this._inner(f,{success:function(){this._success(g,f);h()},fail:function(){this._fail(g,f);h()},itemData:j}))}};if(!g||this.isInode(g)){k.apply(this)}else{this.setInode(g,this._inner(f,{success:k,fail:f.fail}))}}else{var k=function(){this._fail(g,f);h()};if(!g||this.isLeaf(g)){k.apply(this)}else{this.setLeaf(g,this._inner(f,{success:k,fail:k}))}}});i.error=this.proxy(function(){this._fail(g,f);h()});c.ajax(i)},true)}else{this._fail(g,f)}},loadFrom:function(g,f){if(g&&this.isBusy(g)){this._delayBusy(g,function(){this.loadFrom(g,f)});return}f=this._options(f,function(){this._loading(g);this._trigger(g,"loaded",f)},function(){this._loading(g);this._trigger(g,"loadfail",f)},function(){this._loading(g);this._trigger(g,"wasloaded",f)});if(!g||this.isInode(g)){if(!this._trigger(g,"beforeload",f)){this._fail(g,f);return}this._loading(g,true);if(this.wasLoad(g)){this._notify(g,f);return}if(f.itemData&&(f.itemData instanceof Array)&&f.itemData.length){var h=function(){if(this.wasLoad(g)){this._notify(g,f)}else{this._createBranch(g,f)}};if(!g||this.isInode(g)){h.apply(this)}else{this.setInode(g,this._inner(f,{success:h,fail:f.fail}))}}else{if(!g||this.isLeaf(g)){this._fail(g,f)}else{this.setLeaf(g,this._inner(f,{success:f.fail,fail:f.fail}))}}}else{this._fail(g,f)}},unload:function(i,f){f=this._options(f,function(){this._loading(i);this._trigger(i,"unloaded",f)},function(){this._loading(i);this._trigger(i,"unloadfail",f)},function(){this._loading(i);this._trigger(i,"notloaded",f)});if(!i||this.isInode(i)){if(!this._trigger(i,"beforeunload",f)){this._fail(i,f);return}this._loading(i,true);if(!this.wasLoad(i)){this._notify(i,f);return}var h=false;var g=this.children(i,true);g.each(this.proxy(function(j){var k=c(j);if(this.isInode(k)){if(this.isOpen(k)){if(!this._trigger(k,"beforeclose",f)){h=true;return false}}if(this.wasLoad(k)){if(!this._trigger(k,"beforeunload",f)){h=true;return false}}}if(!this._trigger(k,"beforeremove",f)){h=true;return false}},true));if(h){this._fail(i,f);return}g.each(this.proxy(function(j){var k=c(j);if(this.isInode(k)){if(this.isOpen(k)){this._trigger(k,"closed",f)}if(this.wasLoad(k)){this._trigger(k,"unloaded",f)}}this._trigger(k,"removed",f)},true));if(i){if(this.isOpen(i)){this.close(i,this._inner(f,{success:function(){this._removeContainer(i);this._success(i,f)},fail:f.fail}))}else{this._removeContainer(i);this._success(i,f)}}else{this._animate(i,false,!this._instance.options.animateRoot||f.unanimated,function(){this._removeContainer();this._success(i,f)})}}else{this._fail(i,f)}},remove:function(h,f){f=this._options(f,function(){if(this.isOpenPath(h)){h.removeClass("aciTreeVisible");this._updateOddEven(h)}this._trigger(h,"removed",f)},function(){this._trigger(h,"removefail",f)});if(this.isItem(h)){if(!this._trigger(h,"beforeremove",f)){this._fail(h,f);return}if(this.isInode(h)&&this.wasLoad(h)){this.unload(h,this._inner(f,{success:function(){this._success(h,f);this._removeItem(h)},fail:f.fail}))}else{if(this.hasSiblings(h,true)){this._success(h,f);this._removeItem(h)}else{var g=this.parent(h);this.unload(g.length?g:null,this._inner(f,{success:f.success,fail:f.fail}))}}}else{this._fail(h,f)}},_openChildren:function(h,g){if(g.expand){var f=this._instance.queue;this.inodes(this.children(h)).each(function(){var i=c(this);f.push(function(j){this.open(i,this._inner(g));j()})});f.push(function(i){this._success(h,g);i()})}else{this._success(h,g)}},_openItem:function(g,f){if(!f.unanimated&&!this.isVisible(g)){f.unanimated=true}if(f.unique){this.closeOthers(g);f.unique=false}this._coreDOM.toggle(g,true);this._updateOddEvenChildren(g);this._animate(g,true,f.unanimated,function(){this._openChildren(g,f)})},open:function(g,f){f=this._options(f,function(){if(this.isOpenPath(g)){this._updateVisible(g);this._updateOddEven(g)}this._trigger(g,"opened",f)},function(){this._trigger(g,"openfail",f)},function(){this._trigger(g,"wasopened",f)});if(this.isInode(g)){if(!this._trigger(g,"beforeopen",f)){this._fail(g,f);return}if(this.isOpen(g)){f.success=f.notify;this._openChildren(g,f)}else{if(this.wasLoad(g)){this._openItem(g,f)}else{this.ajaxLoad(g,this._inner(f,{success:function(){this._openItem(g,f)},fail:f.fail}))}}}else{this._fail(g,f)}},_closeChildren:function(h,g){if(this._instance.options.empty){g.unanimated=true;this.unload(h,g)}else{if(g.collapse){var f=this._instance.queue;this.inodes(this.children(h)).each(function(){var i=c(this);f.push(function(j){this.close(i,this._inner(g,{unanimated:true}));j()})});f.push(function(i){this._success(h,g);i()})}else{this._success(h,g)}}},_closeItem:function(g,f){if(!f.unanimated&&!this.isVisible(g)){f.unanimated=true}this._coreDOM.toggle(g,false);this._animate(g,false,f.unanimated,function(){this._closeChildren(g,f)})},close:function(g,f){f=this._options(f,function(){if(this.isOpenPath(g)){this._updateVisible(g);this._updateOddEven(g)}this._trigger(g,"closed",f)},function(){this._trigger(g,"closefail",f)},function(){this._trigger(g,"wasclosed",f)});if(this.isInode(g)){if(!this._trigger(g,"beforeclose",f)){this._fail(g,f);return}if(this.isOpen(g)){this._closeItem(g,f)}else{if(this.wasLoad(g)){f.success=f.notify;this._closeChildren(g,f)}else{this._notify(g,f)}}}else{this._fail(g,f)}},_updateVisible:function(g){if(this.isOpenPath(g)){if(!g.hasClass("aciTreeHidden")){g.addClass("aciTreeVisible");var f=this.children(g);this.inodes(f,true).each(this.proxy(function(h){var i=c(h);if(!i.hasClass("aciTreeVisible")){this._updateVisible(i)}},true));f.addClass("aciTreeVisible")}}else{if(g.hasClass("aciTreeVisible")){g.removeClass("aciTreeVisible").find(".aciTreeVisible").removeClass("aciTreeVisible")}}},closeOthers:function(i,h){h=this._options(h);if(this.isItem(i)){var f=this._instance.queue;var g=i.add(this.path(i)).add(this.children(i,true));this.inodes(this.children(null,true,true),true).not(g).each(function(){var j=c(this);f.push(function(k){this.close(j,this._inner(h));k()})});f.push(function(j){this._success(i,h);j()})}else{this._fail(i,h)}},toggle:function(g,f){f=this._options(f,function(){this._trigger(g,"toggled",f)},function(){this._trigger(g,"togglefail",f)});if(this.isInode(g)){if(!this._trigger(g,"beforetoggle",f)){this._fail(g,f);return}if(this.isOpen(g)){this.close(g,f)}else{this.open(g,f)}}else{this._fail(g,f)}},path:function(g,f){if(g){var h=g.parentsUntil(this._instance.jQuery,".aciTreeLi");return f?h:c(h.get().reverse())}return c([])},isVisible:function(j,g){if(j&&this.isOpenPath(j)){var i=this._instance.jQuery.get(0).getBoundingClientRect();var h=j.children(".aciTreeLine").find(".aciTreeItem");var l=h.get(0).getBoundingClientRect();var f=h.outerHeight(true);var k=g?this._instance.jQuery.innerHeight()/2:0;if((l.bottom-f<i.top+k)||(l.top+f>i.bottom-k)){return false}return true}return false},openPath:function(h,g){g=this._options(g);if(this.isItem(h)){var f=this._instance.queue;this.inodes(this.path(h),false).each(function(){var i=c(this);f.push(function(j){this.open(i,this._inner(g));j()})});f.push(function(i){this._success(h,g);i()})}else{this._fail(h,g)}},isOpenPath:function(g){var f=this.parent(g);return f.length?f.hasClass("aciTreeVisible"):true},_speedFraction:function(h,f,i){if((i<f)&&f){var g=parseInt(h);if(isNaN(g)){switch(h){case"slow":g=600;break;case"medium":g=400;break;case"fast":g=200;break;default:return h}}return g*i/f}return h},setVisible:function(g,f){f=this._options(f,function(){this._trigger(g,"visible",f)},function(){this._trigger(g,"visiblefail",f)},function(){this._trigger(g,"wasvisible",f)});if(this.isItem(g)){if(!this._trigger(g,"beforevisible",f)){this._fail(g,f);return}if(this.isVisible(g)){this._notify(g,f);return}var h=function(){var k=this._instance.jQuery.get(0).getBoundingClientRect();var j=g.children(".aciTreeLine").find(".aciTreeItem");var n=j.get(0).getBoundingClientRect();var i=j.outerHeight(true);var m=f.center?this._instance.jQuery.innerHeight()/2:0;if(n.bottom-i<k.top+m){var l=k.top+m-n.bottom+i;if(!f.unanimated&&this._instance.options.view){this._instance.jQuery.stop(true).animate({scrollTop:this._instance.jQuery.scrollTop()-l},{duration:this._speedFraction(this._instance.options.view.duration,k.bottom-k.top,l),easing:this._instance.options.view.easing,complete:this.proxy(function(){this._success(g,f)})})}else{this._instance.jQuery.stop(true).get(0).scrollTop=this._instance.jQuery.scrollTop()-l;this._success(g,f)}}else{if(n.top+i>k.bottom-m){var l=n.top-k.bottom+m+i;if(!f.unanimated&&this._instance.options.view){this._instance.jQuery.stop(true).animate({scrollTop:this._instance.jQuery.scrollTop()+l},{duration:this._speedFraction(this._instance.options.view.duration,k.bottom-k.top,l),easing:this._instance.options.view.easing,complete:this.proxy(function(){this._success(g,f)})})}else{this._instance.jQuery.stop(true).get(0).scrollTop=this._instance.jQuery.scrollTop()+l;this._success(g,f)}}else{this._success(g,f)}}};if(this.hasParent(g)){this.openPath(g,this._inner(f,{success:h,fail:f.fail}))}else{h.apply(this)}}else{this._fail(g,f)}},hasParent:function(f){return this.parent(f).length>0},parent:function(f){return f?f.parent().parent(".aciTreeLi"):c([])},topParent:function(f){return this.path(f).eq(0)},_createBranch:function(h,g){var f=new this._task(this._instance.queue,function(){this._success(h,g)});var i=this.proxy(function(k,j){if(k){k.first().removeClass("aciTreeInodeMaybe").addClass("aciTreeInode")}this.append(k,this._inner(g,{success:function(o,m){var l;for(var n in m.itemData){l=m.itemData[n];if(l.branch&&(l.branch instanceof Array)&&l.branch.length){(function(q,p){f.push(function(r){i(q,p.branch);if(p.open){this.open(q)}r()})})(m.items.eq(n),l)}else{if(l.open){this.open(m.items.eq(n),this._inner(m))}}}},fail:g.fail,itemData:j}))});f.push(function(j){i(h,g.itemData);j()})},_updateFirstLast:function(g,f){if(f){f.removeClass("aciTreeFirst aciTreeLast")}this.first(g).addClass("aciTreeFirst");this.last(g).addClass("aciTreeLast")},_setOddEven:function(f,g){f.filter(":odd").removeClass(g?"aciTreeEven":"aciTreeOdd").addClass(g?"aciTreeOdd":"aciTreeEven");f.filter(":even").removeClass(g?"aciTreeOdd":"aciTreeEven").addClass(g?"aciTreeEven":"aciTreeOdd")},_updateOddEven:function(f){var j=this._instance.jQuery.find(".aciTreeVisible");var g=0;if(f){f.each(function(){var k=j.index(this);if(k!=-1){g=Math.min(k,g)}});g=Math.max(g-1,0)}var h=true;if(g>0){var i=j.eq(g);if(i.hasClass("aciTreOdd")){h=false}j=j.filter(":gt("+g+")")}this._setOddEven(j,h)},_updateOddEvenChildren:function(g){var h=g.hasClass("aciTreeOdd");var f=this.children(g);this._setOddEven(f,h)},_itemHook:function(g,h,f,i){if(this._instance.options.itemHook){this._instance.options.itemHook.apply(this,arguments)}},_createItem:function(f,l){var j=c('<li class="aciTreeLi aciTreeLevel'+l+'" role="treeitem" aria-level="'+(l+1)+'" tabindex="-1" aria-selected="false"></li>').data("itemData"+this._instance.nameSpace,c.extend({},f,{branch:f.branch&&f.branch.length}));var k='<div class="aciTreeLine">',g="";for(var h=0;h<l;h++){k+='<div class="aciTreeBranch aciTreeLevel'+h+'">';g+="</div>"}k+='<div class="aciTreeEntry"><span class="aciTreeButton"><span></span></span><span class="aciTreeItem">';if(f.icon){if(f.icon instanceof Array){k+='<span class="aciTreeIcon '+f.icon[0]+'" style="background-position:'+f.icon[1]+"px "+f.icon[2]+'px"></span>'}else{k+='<span class="aciTreeIcon '+f.icon+'"></span>'}}j.append(k+'<span class="aciTreeText">'+f.label+"</span></span></div>"+g+"</div>");if(f.inode||(f.inode===null)){this._coreDOM.inode(j,f.inode||(f.branch&&f.branch.length))}else{this._coreDOM.leaf(j)}return j},_removeItem:function(g){var f=this.parent(g);g.remove();this._updateFirstLast(f.length?f:null)},_createItems:function(k,m,g,h,f){if(h){var n;if(k){n=this.itemFrom(k)}else{if(m){n=this.parent(m)}else{if(g){n=this.parent(g)}}}var l=[],o;if(h instanceof Array){for(var j in h){o=this._createItem(h[j],f);this._itemHook(n,o,h[j],f);l[l.length]=o.get(0)}}else{o=this._createItem(h,f);this._itemHook(n,o,h,f);l[l.length]=o.get(0)}l=c(l);if(k){k.append(l)}else{if(m){m.before(l)}else{if(g){g.after(l)}}}return l}return c([])},_createContainer:function(g){if(!g){g=this._instance.jQuery}var f=g.children(".aciTreeUl");if(!f.length){f=c('<ul class="aciTreeUl" role="group" style="display:none"></ul>');g.append(f)}return f},_removeContainer:function(f){if(!f){f=this._instance.jQuery}f.children(".aciTreeUl").remove()},append:function(i,g){g=this._options(g,function(){this._trigger(i,"appended",g)},function(){this._trigger(i,"appendfail",g)});if(i){if(this.isInode(i)){if(!this._trigger(i,"beforeappend",g)){this._fail(i,g);return}var h=this.last(i);var f=this._createContainer(i);var j=this._createItems(f,null,null,g.itemData,this.level(i)+1);if(j.length){i.addClass("aciTreeInode").removeClass("aciTreeInodeMaybe");this._updateFirstLast(i,h);if(this.isHidden(i)){j.addClass("aciTreeHidden")}else{if(this.isOpenPath(i)&&this.isOpen(i)){j.addClass("aciTreeVisible");this._updateOddEven(j.first())}}j.each(this.proxy(function(k){this._trigger(c(k),"added",g)},true))}else{if(!this.hasChildren(i,true)){f.remove()}}g.items=j;this._success(i,g)}else{this._fail(i,g)}}else{if(!this._trigger(i,"beforeappend",g)){this._fail(i,g);return}var h=this.last();var f=this._createContainer();var j=this._createItems(f,null,null,g.itemData,0);if(j.length){this._updateFirstLast(null,h);j.addClass("aciTreeVisible");this._updateOddEven();j.each(this.proxy(function(k){this._trigger(c(k),"added",g)},true));this._animate(null,true,!this._instance.options.animateRoot||g.unanimated)}else{if(!this.hasChildren(null,true)){f.remove()}}g.items=j;this._success(i,g)}},before:function(i,f){f=this._options(f,function(){this._trigger(i,"before",f)},function(){this._trigger(i,"beforefail",f)});if(this.isItem(i)){if(!this._trigger(i,"beforebefore",f)){this._fail(i,f);return}var h=this.prev(i);var j=this._createItems(null,i,null,f.itemData,this.level(i));if(j.length){if(!h.length){i.removeClass("aciTreeFirst");j.first().addClass("aciTreeFirst")}var g=this.parent(i);if(g.length&&this.isHidden(g)){j.addClass("aciTreeHidden")}else{if(this.isOpenPath(i)){j.addClass("aciTreeVisible");this._updateOddEven(j.first())}}j.each(this.proxy(function(k){this._trigger(c(k),"added",f)},true))}f.items=j;this._success(i,f)}else{this._fail(i,f)}},after:function(i,f){f=this._options(f,function(){this._trigger(i,"after",f)},function(){this._trigger(i,"afterfail",f)});if(this.isItem(i)){if(!this._trigger(i,"beforeafter",f)){this._fail(i,f);return}var h=this.next(i);var j=this._createItems(null,null,i,f.itemData,this.level(i));if(j.length){if(!h.length){i.removeClass("aciTreeLast");j.last().addClass("aciTreeLast")}var g=this.parent(i);if(g.length&&this.isHidden(g)){j.addClass("aciTreeHidden")}else{if(this.isOpenPath(i)){j.addClass("aciTreeVisible");this._updateOddEven(j.first())}}j.each(this.proxy(function(k){this._trigger(c(k),"added",f)},true))}f.items=j;this._success(i,f)}else{this._fail(i,f)}},itemFrom:function(f){if(f){var g=c(f);if(g.get(0)==this._instance.jQuery.get(0)){return c([])}else{return g.closest(".aciTreeLi")}}return c([])},children:function(g,f,h){if(!g){g=this._instance.jQuery}return f?g.find(".aciTreeLi"+(h?"":":not(.aciTreeHidden)")):g.children(".aciTreeUl").children(".aciTreeLi"+(h?"":":not(.aciTreeHidden)"))},_firstLast:function(f){if(!f){f=this._instance.jQuery}return f.children(".aciTreeUl").children(".aciTreeFirst,.aciTreeLast")},visible:function(g,f){g=g.filter(".aciTreeVisible");if(f){var h=c.grep(g.get(),this.proxy(function(i){return this.isVisible(c(i))}));g=c(h)}return g},inodes:function(f,g){if(g!==e){if(g){return f.filter(".aciTreeOpen")}else{return f.filter(".aciTreeInode,.aciTreeInodeMaybe").not(".aciTreeOpen")}}return f.filter(".aciTreeInode,.aciTreeInodeMaybe")},leaves:function(f){return f.filter(".aciTreeLeaf")},isInode:function(f){return f&&(f.hasClass("aciTreeInode")||f.hasClass("aciTreeInodeMaybe"))},isLeaf:function(f){return f&&f.hasClass("aciTreeLeaf")},wasLoad:function(f){if(!f){return this._instance.jQuery.children(".aciTreeUl").length>0}if(this.isInode(f)){return f.children(".aciTreeUl").length>0}return true},setInode:function(g,f){f=this._options(f,function(){this._trigger(g,"inodeset",f)},function(){this._trigger(g,"inodefail",f)},function(){this._trigger(g,"wasinode",f)});if(this.isItem(g)){if(!this._trigger(g,"beforeinode",f)){this._fail(g,f);return}if(this.isLeaf(g)){this._coreDOM.inode(g);this._success(g,f)}else{this._notify(g,f)}}else{this._fail(g,f)}},setLeaf:function(g,f){f=this._options(f,function(){this._trigger(g,"leafset",f)},function(){this._trigger(g,"leaffail",f)},function(){this._trigger(g,"wasleaf",f)});if(this.isItem(g)){if(!this._trigger(g,"beforeleaf",f)){this._fail(g,f);return}if(this.isInode(g)){var h=function(){this._coreDOM.leaf(g);this._success(g,f)};if(this.wasLoad(g)){this.unload(g,this._inner(f,{success:h,fail:f.fail}))}else{h.apply(this)}}else{this._notify(g,f)}}else{this._fail(g,f)}},setIcon:function(j,g){g=this._options(g,null,function(){this._trigger(j,"iconfail",g)});if(this.isItem(j)){if(!this._trigger(j,"beforeicon",g)){this._fail(j,g);return}var i=g.icon;var f=this.itemData(j);g.oldIcon=f.icon;var h=j.children(".aciTreeLine").find(".aciTreeItem");var k=h.children(".aciTreeIcon");if(k.length){if(i){if(i instanceof Array){k.attr("class","aciTreeIcon "+i[0]).css("background-position",i[1]+"px "+i[2]+"px")}else{k.attr("class","aciTreeIcon "+i)}f.icon=i;this._trigger(j,"iconset",g)}else{k.remove();f.icon=null;this._trigger(j,"iconremoved",g)}}else{if(i){if(i instanceof Array){h.prepend('<div class="aciTreeIcon '+i[0]+'" style="background-position:'+i[1]+"px "+i[2]+'px"></div>')}else{h.prepend('<div class="aciTreeIcon '+i+'"></div>')}f.icon=i;this._trigger(j,"iconadded",g)}else{this._trigger(j,"noticon",g)}}this._success(j,g)}else{this._fail(j,g)}},getIcon:function(g){var f=this.itemData(g);return f?f.icon:null},setLabel:function(i,h){h=this._options(h,null,function(k,j){this._trigger(k,"labelfail",j)},function(){this._trigger(i,"waslabel",h)});if(this.isItem(i)){if(!this._trigger(i,"beforelabel",h)){this._fail(i,h);return}var g=h.label;var f=this.itemData(i);h.oldLabel=f.label;if(g==h.oldLabel){this._notify(i,h)}else{i.children(".aciTreeLine").find(".aciTreeText").html(g);f.label=g;this._trigger(i,"labelset",h);this._success(i,h)}}else{this._fail(i,h)}},hide:function(h,f){f=this._options(f,function(){this._trigger(h,"hidden",f)},function(){this._trigger(h,"hidefail",f)},function(){this._trigger(h,"washidden",f)});if(this.isItem(h)){if(!this._trigger(h,"beforehide",f)){this._fail(h,f);return}if(this.isHidden(h)){this._notify(h,f)}else{h.removeClass("aciTreeVisible").addClass("aciTreeHidden");this.children(h,true).removeClass("aciTreeVisible").addClass("aciTreeHidden");var g=this.parent(h);this._updateFirstLast(g.length?g:null,h);this._updateOddEven(h);this._success(h,f)}}else{this._fail(h,f)}},isHidden:function(f){return f&&f.hasClass("aciTreeHidden")},isHiddenPath:function(g){var f=this.parent(g);return f.length?f.hasClass("aciTreeHidden"):false},_updateHidden:function(f){if(this.isHiddenPath(f)){if(!f.hasClass("aciTreeHidden")){f.addClass("aciTreeHidden");this._updateVisible(f)}}else{this._updateVisible(f)}},hidden:function(f){return f.filter(".aciTreeHidden")},_showHidden:function(g){var f=null;var h=this.path(g);h.each(this.proxy(function(i){var j=c(i);if(this.isHidden(j)){j.removeClass("aciTreeHidden");if(this.isOpenPath(j)&&(!f||this.isOpen(f))){j.addClass("aciTreeVisible")}this._updateFirstLast(f,this._firstLast(f))}f=j},true));g.removeClass("aciTreeHidden");if(this.isOpenPath(g)&&(!f||this.isOpen(f))){g.addClass("aciTreeVisible")}this._updateFirstLast(f,this._firstLast(f))},show:function(h,f){f=this._options(f,function(){this._trigger(h,"shown",f)},function(){this._trigger(h,"showfail",f)},function(){this._trigger(h,"wasshown",f)});if(this.isItem(h)){if(!this._trigger(h,"beforeshow",f)){this._fail(h,f);return}if(this.isHidden(h)){this._showHidden(h);var g=this.topParent(h);this._updateOddEven(g.length?g:h);this._success(h,f)}else{this._notify(h,f)}}else{this._fail(h,f)}},isOpen:function(f){return f&&f.hasClass("aciTreeOpen")},isClosed:function(f){return !this.isOpen(f)},hasChildren:function(f,g){return this.children(f,null,g).length>0},hasSiblings:function(f,g){return this.siblings(f,g).length>0},hasPrev:function(f,g){return this.prev(f,g).length>0},hasNext:function(f,g){return this.next(f,g).length>0},siblings:function(f,g){return f?f.siblings(".aciTreeLi"+(g?"":":not(.aciTreeHidden)")):c([])},prev:function(f,g){return f?(g?f.prev(".aciTreeLi"):f.prevAll(".aciTreeLi:not(.aciTreeHidden):first")):c([])},next:function(f,g){return f?(g?f.next(".aciTreeLi"):f.nextAll(".aciTreeLi:not(.aciTreeHidden):first")):c([])},level:function(f){var g=-1;if(f){while(f.hasClass("aciTreeLi")){f=f.parent().parent();g++}}return g},getId:function(g){var f=this.itemData(g);return f?f.id:null},itemData:function(f){return f?f.data("itemData"+this._instance.nameSpace):null},setId:function(h,g){g=this._options(g,null,function(){this._trigger(h,"idfail",g)},function(){this._trigger(h,"wasid",g)});if(this.isItem(h)){if(!this._trigger(h,"beforeid",g)){this._fail(h,g);return}var i=g.id;var f=this.itemData(h);g.oldId=f.id;if(i==g.oldId){this._notify(h,g)}else{f.id=i;this._trigger(h,"idset",g);this._success(h,g)}}else{this._fail(h,g)}},getIndex:function(f){return f?f.parent().children(".aciTreeLi").index(f):null},setIndex:function(i,g){var f=g.index;g=this._options(g,null,function(){this._trigger(i,"indexfail",g)},function(){this._trigger(i,"wasindex",g)});if(this.isItem(i)){if(!this._trigger(i,"beforeindex",g)){this._fail(i,g);return}g.oldIndex=this.getIndex(i);var j=this.siblings(i);if((f!=g.oldIndex)&&j.length){if(f<1){j.first().before(i)}else{if(f>=j.length){j.last().after(i)}else{j.eq(f).before(i)}}var h=this.parent(i);this._updateFirstLast(h.length?h:null,i.add([j.get(0),j.get(-1)]));this._updateOddEven(h);this._trigger(i,"indexset",g);this._success(i,g)}else{this._notify(i,g)}}else{this._fail(i,g)}},getLabel:function(g){var f=this.itemData(g);return f?f.label:null},isItem:function(f){return f&&f.hasClass("aciTreeLi")},_animate:function(i,j,h,k){if(!i){i=this._instance.jQuery}if(!h){var g=j?this._instance.options.show:this._instance.options.hide;if(g){var f=i.children(".aciTreeUl");if(f.length){f.stop(true,true).animate(g.props,{duration:g.duration,easing:g.easing,complete:k?this.proxy(k):null})}else{if(k){k.apply(this)}}return}}i.children(".aciTreeUl").stop(true,true).toggle(j);if(k){k.apply(this)}},first:function(f,g){if(!f){f=this._instance.jQuery}return f.children(".aciTreeUl").children(".aciTreeLi"+(g?"":":not(.aciTreeHidden)")+":first")},isFirst:function(g,h){if(g){var f=this.parent(g);return this.first(f.length?f:null,h).is(g)}return false},last:function(f,g){if(!f){f=this._instance.jQuery}return f.children(".aciTreeUl").children(".aciTreeLi"+(g?"":":not(.aciTreeHidden)")+":last")},isLast:function(g,h){if(g){var f=this.parent(g);return this.last(f.length?f:null,h).is(g)}return false},isBusy:function(f){if(f){return f.hasClass("aciTreeLoad")}else{return this._instance.queue.busy()}},_loading:function(f,g){if(f){if(g){f.attr("aria-busy",true)}else{f.removeAttr("aria-busy")}f.toggleClass("aciTreeLoad",g)}else{if(g){this._loader(g)}}},_loader:function(f){if(f||this.isBusy()){if(!this._private.loaderInterval){this._private.loaderInterval=b.setInterval(this.proxy(function(){this._loader()}),this._instance.options.loaderDelay)}this._instance.jQuery.addClass("aciTreeLoad");b.clearTimeout(this._private.loaderHide);this._private.loaderHide=b.setTimeout(this.proxy(function(){this._instance.jQuery.removeClass("aciTreeLoad")}),this._instance.options.loaderDelay*2)}},isChildren:function(g,f){if(!g){g=this._instance.jQuery}return f&&(g.has(f).length>0)},isImmediateChildren:function(g,f){if(!g){g=this._instance.jQuery}return f&&g.children(".aciTreeUl").children(".aciTreeLi").is(f)},sameParent:function(h,f){if(h&&f){var i=this.parent(h);var g=this.parent(f);return(!i.length&&!g.length)||(i.get(0)==g.get(0))}return false},sameTopParent:function(h,f){if(h&&f){var i=this.topParent(h);var g=this.topParent(f);return(!i.length&&!g.length)||(i.get(0)==g.get(0))}return false},_serialize:function(f,h){var g=this.itemData(f);if(this.isInode(f)){g.inode=true;if(this.wasLoad(f)){g.open=this.isOpen(f);g.branch=[];this.children(f,false,true).each(this.proxy(function(i){var j=this._serialize(c(i),h);if(h){j=h.call(this,c(i),{},j)}else{j=this._instance.options.serialize.call(this,c(i),{},j)}if(j){g.branch.push(j)}},true))}else{g.open=false;g.branch=null}}else{g.inode=false;g.open=null;g.branch=null}return g},serialize:function(f,i,j){if(typeof i=="object"){if(f){var h=this._serialize(f,j);if(j){h=j.call(this,f,{},h)}else{h=this._instance.options.serialize.call(this,f,{},h)}return h}else{var g=[];this.children(null,false,true).each(this.proxy(function(k){var l=this._serialize(c(k),j);if(j){l=j.call(this,c(k),{},l)}else{l=this._instance.options.serialize.call(this,c(k),{},l)}if(l){g.push(l)}},true));return g}}return""},destroy:function(f){f=this._options(f);if(!this.wasInit()){this._trigger(null,"notinit",f);this._fail(null,f);return}if(this.isLocked()){this._trigger(null,"locked",f);this._fail(null,f);return}if(!this._trigger(null,"beforedestroy",f)){this._trigger(null,"destroyfail",f);this._fail(null,f);return}this._instance.locked=true;this._instance.jQuery.addClass("aciTreeLoad").attr("aria-busy",true);this._instance.queue.destroy();this._destroyHook(false);this.unload(null,this._inner(f,{success:this.proxy(function(){b.clearTimeout(this._private.loaderHide);b.clearInterval(this._private.loaderInterval);this._destroyHook(true);this._instance.jQuery.unbind(this._instance.nameSpace).off(this._instance.nameSpace,".aciTreeButton").off(this._instance.nameSpace,".aciTreeLine");this._instance.jQuery.removeClass("aciTree"+this._instance.index+" aciTreeLoad").removeAttr("role aria-busy");this._instance.locked=false;this._super();this._trigger(null,"destroyed",f);this._success(null,f)}),fail:function(){this._instance.jQuery.removeClass("aciTreeLoad");this._instance.locked=false;this._trigger(null,"destroyfail",f);this._fail(null,f)}}))},_destroyHook:function(f){}};aciPluginClass.plugins.aciTree=aciPluginClass.aciPluginUi.extend(d,"aciTreeCore");aciPluginClass.publish("aciTree",a)})(jQuery,this);

// utils
(function(d,c,e){var a={filterHook:function(g,f,h){return f.length?h.test(c.String(this.getLabel(g))):true}};var b={__extend:function(){d.extend(this._instance,{filter:new this._queue(this,this._instance.options.queue)});this._instance.filter.destroy();this._super()},update:function(h,f){f=this._options(f,function(){this._trigger(h,"updated",f)},function(){this._trigger(h,"updatefail",f)});if(this.isItem(h)){if(!this._trigger(h,"beforeupdate",f)){this._fail(h,f);return}var g=function(){if(f.itemData.id!==e){this.setId(h,{id:f.itemData.id})}if(f.itemData.label!==e){this.setLabel(h,{label:f.itemData.label})}if(f.itemData.icon!==e){this.setIcon(h,{icon:f.itemData.icon})}};if(f.itemData.inode||(f.itemData.inode===null)){var i=function(){g.apply(this);h.removeClass("aciTreeInode aciTreeInodeMaybe").addClass((f.itemData.inode||(f.itemData.branch&&f.itemData.branch.length))?"aciTreeInode":"aciTreeInodeMaybe");if(f.itemData.branch){if(this.wasLoad(h)){this.unload(h,this._inner(f,{success:function(){this.loadFrom(h,this._inner(f,{success:f.success,fail:f.fail,itemData:f.itemData.branch}))},fail:f.fail}))}else{this.loadFrom(h,this._inner(f,{success:f.success,fail:f.fail,itemData:f.itemData.branch}))}}else{this._success(h,f)}};if(this.isInode(h)){i.apply(this)}else{this.setInode(h,this._inner(f,{success:i,fail:f.fail}))}}else{if(this.isLeaf(h)){g.apply(this)}else{this.setLeaf(h,this._inner(f,{success:g,fail:f.fail}))}}}else{this._fail(h,f)}},branch:function(g,j,h){var f=this._instance.queue;var i=this.proxy(function(l,n,k){var m=k?this.next(l):this.first(l);if(m.length){if(this.isInode(m)){if(this.wasLoad(m)){f.push(function(o){n.call(this,m);i(m,n);i(m,n,true);o()})}else{if(h){this.ajaxLoad(m,{success:function(){n.call(this,m);i(m,n);i(m,n,true)},fail:function(){i(m,n,true)}})}else{f.push(function(o){n.call(this,m);i(m,n,true);o()})}}}else{f.push(function(o){n.call(this,m);i(m,n,true);o()})}}});i(g,j)},swap:function(h){h=this._options(h,null,function(){this._trigger(null,"swapfail",h)});var g=h.item1;var f=h.item2;if(this.isItem(g)&&this.isItem(f)&&!this.isChildren(g,f)&&!this.isChildren(f,g)&&(g.get(0)!=f.get(0))){if(!this._trigger(null,"beforeswap",h)){this._fail(null,h);return}var k=this.prev(g);if(k.length){if(f.get(0)==k.get(0)){f.before(g)}else{g.insertAfter(f);f.insertAfter(k)}}else{var j=this.next(g);if(j.length){if(f.get(0)==j.get(0)){f.after(g)}else{g.insertAfter(f);f.insertBefore(j)}}else{var i=g.parent();g.insertAfter(f);i.append(f)}}this._updateLevel(g);var i=this.parent(g);this._updateFirstLast(i.length?i:null,g);this._updateHidden(g);this._updateLevel(f);i=this.parent(f);this._updateFirstLast(i.length?i:null,f);this._updateHidden(f);this._updateOddEven(g.add(f));this._trigger(null,"swapped",h);this._success(null,h)}else{this._fail(null,h)}},_updateItemLevel:function(k,f,h){k.removeClass("aciTreeLevel"+f).addClass("aciTreeLevel"+h);var j=k.children(".aciTreeLine").find(".aciTreeEntry");if(f<h){for(var g=f;g<h;g++){j.wrap('<div class="aciTreeBranch aciTreeLevel'+g+'"></div>')}}else{if(f>h){for(var g=h;g<f;g++){j.unwrap()}}}},_updateChildLevel:function(h,f,g){this.children(h).each(this.proxy(function(i){var j=d(i);this._updateItemLevel(j,f,g);if(this.isInode(j)){this.children(j).each(this.proxy(function(k){this._updateChildLevel(d(k),f+1,g+1)},true))}},true))},_updateLevel:function(f){var h=this.level(f);var g=c.parseInt(f.attr("class").match(/aciTreeLevel[0-9]+/)[0].match(/[0-9]+/));if(h!=g){this._updateItemLevel(f,g,h);this._updateChildLevel(f,g+1,h+1)}},moveUp:function(g,f){f=this._options(f);f.index=c.Math.max(this.getIndex(g)-1,0);this.setIndex(g,f)},moveDown:function(g,f){f=this._options(f);f.index=c.Math.min(this.getIndex(g)+1,this.siblings(g).length);this.setIndex(g,f)},moveFirst:function(g,f){f=this._options(f);f.index=0;this.setIndex(g,f)},moveLast:function(g,f){f=this._options(f);f.index=this.siblings(g).length;this.setIndex(g,f)},moveBefore:function(i,f){f=this._options(f,null,function(){this._trigger(i,"movefail",f)},function(){this._trigger(i,"wasbefore",f)});var j=f.before;if(this.isItem(i)&&this.isItem(j)&&!this.isChildren(i,j)&&(i.get(0)!=j.get(0))){if(!this._trigger(i,"beforemove",f)){this._fail(i,f);return}if(this.prev(j,true).get(0)==i.get(0)){this._notify(i,f)}else{var g=this.parent(i);var h=this.prev(i,true);if(!h.length){h=g.length?g:this.first()}i.insertBefore(j);if(g.length&&!this.hasChildren(g,true)){this.setLeaf(g)}this._updateLevel(i);this._updateFirstLast(g.length?g:null);g=this.parent(i);this._updateFirstLast(g.length?g:null,i.add(j));this._updateHidden(i);this._updateOddEven(i.add(j).add(h));this._trigger(i,"moved",f);this._success(i,f)}}else{this._fail(i,f)}},moveAfter:function(i,f){f=this._options(f,null,function(){this._trigger(i,"movefail",f)},function(){this._trigger(i,"wasafter",f)});var j=f.after;if(this.isItem(i)&&this.isItem(j)&&!this.isChildren(i,j)&&(i.get(0)!=j.get(0))){if(!this._trigger(i,"beforemove",f)){this._fail(i,f);return}if(this.next(j,true).get(0)==i.get(0)){this._notify(i,f)}else{var g=this.parent(i);var h=this.prev(i,true);if(!h.length){h=g.length?g:this.first()}i.insertAfter(j);if(g.length&&!this.hasChildren(g,true)){this.setLeaf(g)}this._updateLevel(i);this._updateFirstLast(g.length?g:null);g=this.parent(i);this._updateFirstLast(g.length?g:null,i.add(j));this._updateHidden(i);this._updateOddEven(i.add(j).add(h));this._trigger(i,"moved",f);this._success(i,f)}}else{this._fail(i,f)}},asChild:function(h,f){f=this._options(f,null,function(){this._trigger(h,"childfail",f)});var g=f.parent;if(this.isItem(h)&&this.isItem(g)&&!this.isChildren(h,g)&&!this.hasChildren(g,true)&&(h.get(0)!=g.get(0))){if(!this._trigger(h,"beforechild",f)){this._fail(h,f);return}var i=function(){var k=this.parent(h);var l=this.prev(h);if(!l.length){l=k.length?k:this.first()}var j=this._createContainer(g);j.append(h);if(k.length&&!this.hasChildren(k,true)){this.setLeaf(k)}this._updateLevel(h);this._updateFirstLast(k.length?k:null);this._updateFirstLast(g.length?g:null,h);this._updateHidden(h);this._updateOddEven(h.add(l));this._trigger(h,"childset",f);this._success(h,f)};if(this.isInode(g)){i.apply(this)}else{this.setInode(g,this._inner(f,{success:i,fail:f.fail}))}}else{this._fail(h,f)}},_search:function(n,k){var m=this.children(n);var o,f,h,q,l=false;for(var j=0,p=m.length;j<p;j++){o=m.eq(j);f=c.String(this.getId(o));h=f.length;if(h){if(f==k.substr(0,h)){q=o;l=k.length==h;break}}}if(q){if(!l){var g=this._search(q,k);if(g){return g}}return{item:q,exact:l}}else{return null}},searchId:function(j,h,f){f=this._options(f);var k=f.id;if(j){if(h){var i=this.proxy(function(l){var m=this._search(l,k);if(m){if(m.exact){this._success(m.item,f)}else{if(this.wasLoad(m.item)){this._fail(l,f)}else{this.ajaxLoad(m.item,this._inner(f,{success:function(){i(m.item)},fail:f.fail}))}}}else{this._fail(l,f)}});i()}else{var g=this._search(null,k);if(g&&g.exact){this._success(g.item,f)}else{this._fail(null,f)}}}else{var g=d();this._instance.jQuery.find(".aciTreeLi").each(this.proxy(function(l){if(k==this.getId(d(l))){g=d(l);return false}},true));if(g.length){this._success(g,f)}else{this._fail(null,f)}}},_regexp:function(f){return new c.RegExp(c.String(f).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"i")},filter:function(i,g){g=this._options(g,null,function(){this._trigger(i,"filterfail",g)});if(!i||this.isItem(i)){if(!this._trigger(i,"beforefilter",g)){this._fail(i,g);return}var h=c.String(g.search);var j=this._regexp(h);var l=null;this._instance.filter.init();var f=new this._task(this._instance.filter,function(){this._instance.filter.destroy();g.first=l;this._updateOddEven();this._trigger(i,"filtered",g);this._success(i,g)});var k=this.proxy(function(n){var m=this.children(n,false,true);var o=false;m.each(this.proxy(function(p){var q=d(p);if(this._instance.options.filterHook.call(this,q,h,j)){if(!l){l=q}o=true;q.removeClass("aciTreeHidden")}else{q.removeClass("aciTreeVisible").addClass("aciTreeHidden")}if(this.isInode(q)){f.push(function(r){k(q);r()})}},true));if(o){if(n&&this.isHidden(n)){this._showHidden(n)}if(!n||(this.isOpenPath(n)&&this.isOpen(n))){m.not(".aciTreeHidden").addClass("aciTreeVisible")}this._updateFirstLast(n,this._firstLast(n))}});f.push(function(m){k(i);m()})}else{this._fail(i,g)}},_firstAll:function(f){f.call(this,this.first())},_lastAll:function(f,h,g){if(f){if(this.isInode(f)){if(this.wasLoad(f)){this._lastAll(this.last(f),h,g);return}else{if(g){this.ajaxLoad(f,{success:function(){this._lastAll(this.last(f),h,g)},fail:function(){h.call(this,f)}});return}}}h.call(this,f)}else{h.call(this,this.last())}},_nextAll:function(h,j,i){if(h){if(this.isInode(h)){if(this.wasLoad(h)){j.call(this,this.first(h));return}else{if(i){this.ajaxLoad(h,{success:function(){j.call(this,this.first(h))},fail:function(){this._nextAll(h,j,i)}});return}}}var g=this.next(h);if(g.length){j.call(this,g)}else{var f=this.proxy(function(m){var l=this.parent(m);if(l.length){var k=this.next(l);if(k.length){return k}else{return f(l)}}return null});j.call(this,f(h))}}else{j.call(this,this.first())}},_prevAll:function(h,j,i){if(h){var g=this.prev(h);if(g.length){if(this.isInode(g)){this._lastAll(g,j,i)}else{j.call(this,g)}}else{var f=this.parent(h);j.call(this,f.length?f:null)}}else{j.call(this,this.last())}},prevMatch:function(h,g,k){var i=this._regexp(g);this._instance.filter.init();var f=new this._task(this._instance.filter,function(){this._instance.filter.destroy()});var j=function(l){f.push(function(m){this._prevAll(l,function(n){if(n){if(this._instance.options.filterHook.call(this,n,g,i)){k.call(this,n)}else{j(n)}}else{k.call(this,null)}m()})})};j(this.isItem(h)?h:null)},nextMatch:function(h,g,k){var i=this._regexp(g);this._instance.filter.init();var f=new this._task(this._instance.filter,function(){this._instance.filter.destroy()});var j=function(l){f.push(function(m){this._nextAll(l,function(n){if(n){if(this._instance.options.filterHook.call(this,n,g,i)){k.call(this,n)}else{j(n)}}else{k.call(this,null)}m()})})};j(this.isItem(h)?h:null)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(b,"aciTreeUtils");aciPluginClass.defaults("aciTree",a)})(jQuery,this);

// selectable
(function(c,b,d){var a={selectable:true,fullRow:false,textSelection:false};var e={__extend:function(){c.extend(this._instance,{focus:false});c.extend(this._private,{blurTimeout:null,focus:null});this._super()},hasFocus:function(){return this._instance.focus},_lastFocus:function(){return(this._instance.focus&&this._private.focus)?this._private.focus:c([])},_focus:function(f){b.clearTimeout(this._private.blurTimeout);this._private.focus=f;if(!this._instance.focus){this._instance.focus=true;this._instance.jQuery.addClass("aciTreeFocus");this._trigger(null,"focused")}},_blur:function(){b.clearTimeout(this._private.blurTimeout);this._private.blurTimeout=b.setTimeout(this.proxy(function(){if(this._instance.focus){this._instance.focus=false;this._instance.jQuery.removeClass("aciTreeFocus");this._trigger(null,"blurred")}}),10)},_selectableInit:function(){if(this._instance.jQuery.attr("tabindex")===d){this._instance.jQuery.attr("tabindex",0)}this._instance.jQuery.bind("focusin"+this._private.nameSpace,this.proxy(function(f){this._focus(c(f.target))})).bind("focusout"+this._private.nameSpace,this.proxy(function(){this._blur()})).bind("keydown"+this._private.nameSpace,this.proxy(function(h){if(!this._instance.focus){return}var f=this.selected();if(f.length&&this.isBusy(f)){return false}var g=c([]);switch(h.which){case 38:g=f.length?this._prevOpen(f):this.first();break;case 40:g=f.length?this._nextOpen(f):this.first();break;case 37:if(f.length){if(this.isOpen(f)){this.close(f,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique})}else{g=this.parent(f)}}else{g=this.first()}break;case 39:if(f.length){if(this.isInode(f)&&this.isClosed(f)){this.open(f,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique})}else{g=this.first(f)}}else{g=this.first()}break;case 33:g=f.length?this._prevPage(f):this.first();break;case 34:g=f.length?this._nextPage(f):this.first();break;case 36:g=this.first();break;case 35:g=this._lastOpen();break;case 13:case 107:if(f.length&&this.isInode(f)&&this.isClosed(f)){this.open(f,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique})}break;case 27:case 109:if(f.length&&this.isOpen(f)){this.close(f,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique})}if(h.which==27){h.preventDefault()}break;case 32:if(f.length&&this.isInode(f)){this.toggle(f,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique})}h.preventDefault();break;case 106:if(f.length&&this.isInode(f)){this.open(f,{collapse:this._instance.options.collapse,expand:true,unique:this._instance.options.unique})}break}if(g.length){if(!this.isSelected(g)){if(!this.isVisible(g)){this.setVisible(g)}this.select(g,{select:true});return false}else{if(!this.isVisible(g)){this.setVisible(g);return false}}}}));this._fullRow(this._instance.options.fullRow)},_fullRow:function(f){this._instance.jQuery.off(this._private.nameSpace,".aciTreeLine,.aciTreeItem").off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.on("click"+this._private.nameSpace,f?".aciTreeLine,.aciTreeItem":".aciTreeItem",this.proxy(function(h){var g=this.itemFrom(h.target);if(!this.isVisible(g)){this.setVisible(g)}if(!this.isSelected(g)){this.select(g,{select:true})}})).on("dblclick"+this._private.nameSpace,f?".aciTreeLine,.aciTreeItem":".aciTreeItem",this.proxy(function(h){var g=this.itemFrom(h.target);if(this.isInode(g)){this.toggle(g,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique});return false}}))},_initHook:function(){if(this.extSelectable()){this._selectableInit()}this._super()},_itemHook:function(g,h,f,i){if(!this._instance.options.textSelection){this._selectable(h.children(".aciTreeLine").find(".aciTreeItem"))}this._super(g,h,f,i)},_selectableDOM:{select:function(f,g){if(g){f.first().addClass("aciTreeSelected").attr("aria-selected",true).focus()}else{f.removeClass("aciTreeSelected").attr("aria-selected",false)}}},_selectable:function(f,g){if(g){f.css({"-webkit-user-select":"text","-moz-user-select":"text","-ms-user-select":"text","-o-user-select":"text","user-select":"text"}).attr({unselectable:null,onselectstart:null}).unbind("selectstart"+this._private.nameSpace)}else{f.css({"-webkit-user-select":"none","-moz-user-select":"-moz-none","-ms-user-select":"none","-o-user-select":"none","user-select":"none"}).attr({unselectable:"on",onselectstart:"return false"}).bind("selectstart"+this._private.nameSpace,function(){return true})}},_lastOpen:function(f){var g=this.proxy(function(i){var h=this.last(i);if(this.isOpen(h)){return g(h)}else{return h}});if(!f){f=this.last()}if(this.isOpen(f)){return g(f)}else{return f}},_prevOpen:function(h){var g=this.prev(h);if(g.length){return this._lastOpen(g)}else{var f=this.parent(h);return f.length?f:h}},_nextOpen:function(g){var h=this.proxy(function(k){var j=this.parent(k);if(j.length){var i=this.next(j);if(i.length){return i}else{return h(j)}}return null});if(this.isOpen(g)){return this.first(g)}else{var f=this.next(g);if(f.length){return f}else{f=h(g);return f?f:g}}},_itemHeight:function(g){var f=g.children(".aciTreeLine").find(".aciTreeItem");return f.outerHeight(true)},_prevPage:function(i){var f=this._itemHeight(i);var j=this._instance.jQuery.height();var h=c([]),g=i;do{g=this._prevOpen(g);if(g.length){if(g.get(0)==h.get(0)){break}f+=this._itemHeight(g);h=g}else{break}}while(f<j);return g},_nextPage:function(i){var f=this._itemHeight(i);var j=this._instance.jQuery.height();var h=c([]),g=i;do{g=this._nextOpen(g);if(g.length){if(g.get(0)==h.get(0)){break}f+=this._itemHeight(g);h=g}else{break}}while(f<j);return g},select:function(i,h){h=this._options(h,null,function(){this._trigger(i,"selectfail",h)});if(this.extSelectable()&&this.isItem(i)){if(!this._trigger(i,"beforeselect",h)){this._fail(i,h);return}var f=h.select;var g=this._instance.jQuery.find(".aciTreeSelected");if(f){g=g.not(i)}h.oldSelected=this.selected();this._selectableDOM.select(g,false);g.each(this.proxy(function(j){this._trigger(c(j),"unselected",h)},true));if(f){if(this.isSelected(i)){this._trigger(i,"wasselected",h)}else{this._selectableDOM.select(i,true);this._trigger(i,"selected",h)}}this._success(i,h)}else{this._fail(i,h)}},selected:function(){return this._instance.jQuery.find(".aciTreeSelected:first")},isSelected:function(f){return f&&f.hasClass("aciTreeSelected")},extSelectable:function(){return this._instance.options.selectable},option:function(f,g){if(this.wasInit()&&!this.isLocked()){if((f=="selectable")&&(g!=this.extSelectable())){if(g){this._selectableInit()}else{this._selectableDone()}}if((f=="fullRow")&&(g!=this._instance.options.fullRow)){this._fullRow(g)}if((f=="textSelection")&&(g!=this._instance.options.textSelection)){if(g){this._instance.jQuery.find(".aciTreeItem").each(this.proxy(function(h){this._selectable(c(h),true)},true))}else{this._instance.jQuery.find(".aciTreeItem").each(this.proxy(function(h){this._selectable(c(h))},true))}}}this._super(f,g)},_selectableDone:function(f){if(this._instance.jQuery.attr("tabindex")==0){this._instance.jQuery.removeAttr("tabindex")}this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.removeClass("aciTreeFocus");this._instance.focus=false;if(!f){var g=this.selected();if(g.length){this.select(g,{select:false})}}},_destroyHook:function(f){if(f){this._selectableDone(true)}this._super(f)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(e,"aciTreeSelectable");aciPluginClass.defaults("aciTree",a)})(jQuery,this);

// checkbox (works best with selectable)
(function(d,c,e){var b={checkbox:false,checkboxChain:true,checkboxBreak:true,checkboxClick:false};var a={_checkboxInit:function(){this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(j,h,i,f,g){switch(f){case"loaded":h._checkboxLoad(i);break}}).bind("keydown"+this._private.nameSpace,this.proxy(function(g){switch(g.which){case 32:if(this.extSelectable){var f=this.selected();if(this.hasCheckbox(f)){this.check(f,{check:!this.isChecked(f)});g.stopImmediatePropagation();g.preventDefault()}}break}})).on("click"+this._private.nameSpace,".aciTreeItem",this.proxy(function(g){if(!this._instance.options.checkboxClick||d(g.target).is(".aciTreeCheck")){var f=this.itemFrom(g.target);if(this.hasCheckbox(f)){this.check(f,{check:!this.isChecked(f)});g.preventDefault()}}}))},_initHook:function(){if(this.extCheckbox()){this._checkboxInit()}this._super()},_itemHook:function(h,i,f,j){if(this.extCheckbox()){var g=this.extRadio&&this.hasRadio(i);if(!g&&(f.checkbox||(f.checkbox===e))){this._checkboxDOM.add(i,f)}}this._super(h,i,f,j)},_checkboxDOM:{add:function(g,f){g.attr("aria-checked",!!f.checked).addClass("aciTreeCheckbox"+(f.checked?" aciTreeChecked":"")).children(".aciTreeLine").find(".aciTreeText").wrap("<label></label>").before('<span class="aciTreeCheck" />')},remove:function(g){var f=g.removeAttr("aria-checked").removeClass("aciTreeCheckbox aciTreeChecked aciTreeTristate").children(".aciTreeLine").find("label");if(f.length){f.find("*").not(".aciTreeText").remove();f.find(".aciTreeText").unwrap()}},check:function(f,g){f.attr("aria-checked",g).toggleClass("aciTreeChecked",g)},tristate:function(f,g){f.toggleClass("aciTreeTristate",g)}},_checkboxLoad:function(f){if(this._instance.options.checkboxChain===false){return}var g=e;if(this.hasCheckbox(f)){if(this.isChecked(f)){if(!this.checkboxes(this.children(f,false,true),true).length){g=true}}else{g=false}}this._checkboxUpdate(f,g)},_checkboxChildren:function(g){if(this._instance.options.checkboxBreak){var h=[];var i=this.proxy(function(k){var j=this.children(k,false,true);j.each(this.proxy(function(l){var m=d(l);if(this.hasCheckbox(m)){h.push(l);i(m)}},true))});i(g);return d(h)}else{var f=this.children(g,true,true);return this.checkboxes(f)}},_checkboxUpdate:function(i,j){var f=this.proxy(function(o,n,p){var k=this.children(o,false,true);var m=0;var l=0;k.each(this.proxy(function(r){var t=d(r);var s={total:0,checked:0};if(this.hasCheckbox(t)){if((p!==e)&&(this._instance.options.checkboxChain!==-1)){this._checkboxDOM.check(t,p)}m++;if(this.isChecked(t)){l++}f(t,s,p)}else{if(this._instance.options.checkboxBreak){var q={total:0,checked:0};f(t,q)}else{f(t,s,p)}}m+=s.total;l+=s.checked},true));if(o){this._checkboxDOM.tristate(o,(l>0)&&(l!=m));n.total+=m;n.checked+=l}});var h={total:0,checked:0};f(i,h,j);var g=this.proxy(function(o,n,p){var l=this.parent(o);if(l.length){if(!n){var k=this._checkboxChildren(l);var m=this.checkboxes(k,true).length;var n=(m>0)&&(m!=k.length)}if(this.hasCheckbox(l)){if((p!==e)&&(this._instance.options.checkboxChain!==1)){this._checkboxDOM.check(l,n?true:p)}this._checkboxDOM.tristate(l,n);g(l,n,p)}else{if(this._instance.options.checkboxBreak){g(l)}else{g(l,n,p)}}}});g(i,e,j)},hasCheckbox:function(f){return f&&f.hasClass("aciTreeCheckbox")},setCheckbox:function(h,f){f=this._options(f,null,function(){this._trigger(h,"checkboxfail",f)});if(this.extCheckbox()&&this.isItem(h)){if(!this._trigger(h,"beforecheckbox",f)){this._fail(h,f);return}var i=!!f.checkbox;var g=f.checked;if(this.hasCheckbox(h)){if(i){if(g!==e){this.check(h,this._inner(f,{check:g}))}this._trigger(h,"checkboxset",f)}else{this._checkboxDOM.remove(h);this._trigger(h,"checkboxremoved",f)}this._success(h,f)}else{if(i){var j=function(){this._checkboxDOM.add(h,{});if(g===e){this._trigger(h,"checkboxadded",f)}else{this.check(h,this._inner(f,{check:g}));this._trigger(h,"checkboxadded",f)}this._success(h,f)};if(this.extRadio&&this.hasRadio(h)){this.setRadio(h,this._inner(f,{success:j,fail:f.fail,radio:false}))}else{j.apply(this)}}else{this._trigger(h,"notcheckbox",f);this._success(h,f)}}}else{this._fail(h,f)}},isChecked:function(f){if(this.hasCheckbox(f)){return f.hasClass("aciTreeChecked")}if(this._super){return this._super(f)}return false},check:function(h,g){g=this._options(g,null,function(){this._trigger(h,"checkfail",g)});if(this.extCheckbox()&&this.hasCheckbox(h)){if(!this._trigger(h,"beforecheck",g)){this._fail(h,g);return}var f=g.check;this._checkboxDOM.check(h,f);if(this._instance.options.checkboxChain!==false){this._checkboxUpdate(h,f)}this._trigger(h,f?"checked":"unchecked",g);this._success(h,g)}else{if(this._super){this._super(h,g)}else{this._fail(h,g)}}},checkboxes:function(f,h){var g=f.filter(".aciTreeCheckbox");if(h!==e){if(h){return g.filter(".aciTreeChecked")}else{return g.not(".aciTreeChecked")}}return g},_serialize:function(f,h){var g=this._super(f,h);if(g&&this.extCheckbox()){if(this.hasCheckbox(f)){g.checkbox=true;g.checked=this.isChecked(f)}else{g.checkbox=false;g.checked=null}}return g},serialize:function(g,i,j){if(i=="checkbox"){var h="";var f=this.children(g,true,true);this.checkboxes(f,true).each(this.proxy(function(k){var l=d(k);if(j){h+=j.call(this,l,i,this.getId(l))}else{h+=this._instance.options.serialize.call(this,l,i,this.getId(l))}},true));return h}return this._super(g,i,j)},isTristate:function(f){return f&&f.hasClass("aciTreeTristate")},tristate:function(f){return f.filter(".aciTreeTristate")},extCheckbox:function(){return this._instance.options.checkbox},option:function(f,g){if(this.wasInit()&&!this.isLocked()){if((f=="checkbox")&&(g!=this.extCheckbox())){if(g){this._checkboxInit()}else{this._checkboxDone()}}}this._super(f,g)},_checkboxDone:function(f){this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");if(!f){this.checkboxes(this.children(null,true,true)).each(this.proxy(function(g){this.setCheckbox(d(g),false)},true))}},_destroyHook:function(f){if(f){this._checkboxDone(true)}this._super(f)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(a,"aciTreeCheckbox");aciPluginClass.defaults("aciTree",b)})(jQuery,this);

// radio (works best with selectable)
(function(d,b,e){var a={radio:false,radioChain:true,radioBreak:true,radioClick:false};var c={_radioInit:function(){this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(j,h,i,f,g){switch(f){case"loaded":if(i){h._radioLoad(i)}break}}).bind("keydown"+this._private.nameSpace,this.proxy(function(g){switch(g.which){case 32:if(this.extSelectable){var f=this.selected();if(this.hasRadio(f)){if(!this.isChecked(f)){this.check(f,{check:true})}g.stopImmediatePropagation();g.preventDefault()}}break}})).on("click"+this._private.nameSpace,".aciTreeItem",this.proxy(function(g){if(!this._instance.options.radioClick||d(g.target).is(".aciTreeCheck")){var f=this.itemFrom(g.target);if(this.hasRadio(f)){if(!this.isChecked(f)){this.check(f,{check:true})}g.preventDefault()}}}))},_initHook:function(){if(this.extRadio()){this._radioInit()}this._super()},_itemHook:function(g,h,f,j){if(this.extRadio()){var i=this.extCheckbox&&this.hasCheckbox(h);if(!i&&(f.radio||(f.radio===e))){this._radioDOM.add(g,h,f)}}this._super(g,h,f,j)},_radioDOM:{add:function(g,h,f){h.attr("aria-checked",!!f.checked).addClass("aciTreeRadio"+(f.checked?" aciTreeChecked":"")).children(".aciTreeLine").find(".aciTreeText").wrap("<label></label>").before('<span class="aciTreeCheck" />')},remove:function(g){var f=g.removeAttr("aria-checked").removeClass("aciTreeRadio aciTreeChecked").children(".aciTreeLine").find("label");if(f.length){f.find("*").not(".aciTreeText").remove();f.find(".aciTreeText").unwrap()}},check:function(f,g){f.attr("aria-checked",g).toggleClass("aciTreeChecked",g)}},_radioLoad:function(f){if(!this._instance.options.radioChain){return}if(this.hasRadio(f)){if(this.isChecked(f)){if(!this.radios(this.children(f,false,true),true).length){this._radioUpdate(f,true)}}else{this._radioUpdate(f)}}},_radioChildren:function(g){if(this._instance.options.radioBreak){var h=[];var i=this.proxy(function(k){var j=this.children(k,false,true);j.each(this.proxy(function(l){var m=d(l);if(this.hasRadio(m)){h.push(l);i(m)}},true))});i(g);return d(h)}else{var f=this.children(g,true,true);return this.radios(f)}},_radioLevel:function(f){var g=[];f.each(this.proxy(function(i){var j=d(i);var h=this.children(j,false,true);h.each(this.proxy(function(k){var l=d(k);if(!this._instance.options.radioBreak||this.hasRadio(l)){g.push(k)}},true))},true));return d(g)},_radioUpdate:function(h,i){var j=this.proxy(function(k){var l=this.siblings(k,true);this._radioDOM.check(this.radios(l),false);l.each(this.proxy(function(m){var n=d(m);if(!this._instance.options.radioBreak||this.hasRadio(n)){this._radioDOM.check(this._radioChildren(n),false)}},true))});if(i){j(h)}var f=this.proxy(function(m){var k=this._radioLevel(m);var n=this.radios(k);if(n.length){var l=this.radios(k,true);if(l.length){l=l.first();this._radioDOM.check(l,true);j(l);f(l)}else{l=n.first();this._radioDOM.check(l,true);j(l);f(l)}}else{if(k.length){f(k)}}});if(i){f(h)}else{this._radioDOM.check(this._radioChildren(h),false)}var g=this.proxy(function(l){var k=this.parent(l);if(k.length){if(this.hasRadio(k)){if(i){j(k)}this._radioDOM.check(k,i);g(k)}else{if(!this._instance.options.radioBreak){if(i){j(k)}g(k)}}}});if(i!==e){g(h)}},hasRadio:function(f){return f&&f.hasClass("aciTreeRadio")},setRadio:function(i,g){g=this._options(g,null,function(){this._trigger(i,"radiofail",g)});if(this.extRadio()&&this.isItem(i)){if(!this._trigger(i,"beforeradio",g)){this._fail(i,g);return}var f=!!g.radio;var h=g.checked;if(this.hasRadio(i)){if(f){if(h!==e){this.check(i,this._inner(g,{check:h}))}this._trigger(i,"radioset",g)}else{this._radioDOM.remove(i);this._trigger(i,"radioremoved",g)}this._success(i,g)}else{if(f){var j=function(){this._radioDOM.add(this.parent(i),i,{});if(h===e){this._trigger(i,"radioadded",g)}else{this.check(i,this._inner(g,{check:h}));this._trigger(i,"radioadded",g)}this._success(i,g)};if(this.extCheckbox&&this.hasCheckbox(i)){this.setCheckbox(i,this._inner(g,{success:j,fail:g.fail,checkbox:false}))}else{j.apply(this)}}else{this._trigger(i,"notradio",g);this._success(i,g)}}}else{this._fail(i,g)}},isChecked:function(f){if(this.hasRadio(f)){return f.hasClass("aciTreeChecked")}if(this._super){return this._super(f)}return false},check:function(h,g){g=this._options(g,null,function(){this._trigger(h,"checkfail",g)});if(this.extRadio()&&this.hasRadio(h)){if(!this._trigger(h,"beforecheck",g)){this._fail(h,g);return}var f=g.check;this._radioDOM.check(h,f);if(this._instance.options.radioChain){this._radioUpdate(h,f)}this._trigger(h,f?"checked":"unchecked",g);this._success(h,g)}else{if(this._super){this._super(h,g)}else{this._fail(h,g)}}},radios:function(f,h){var g=f.filter(".aciTreeRadio");if(h!==e){if(h){return g.filter(".aciTreeChecked")}else{return g.not(".aciTreeChecked")}}return g},_serialize:function(f,h){var g=this._super(f,h);if(g&&this.extRadio()){if(this.hasRadio(f)){g.radio=true;g.checked=this.isChecked(f)}else{g.radio=false;g.checked=null}}return g},serialize:function(g,i,j){if(i=="radio"){var h="";var f=this.children(g,true,true);this.radios(f,true).each(this.proxy(function(k){var l=d(k);if(j){h+=j.call(this,l,i,this.getId(l))}else{h+=this._instance.options.serialize.call(this,l,i,this.getId(l))}},true));return h}return this._super(g,i,j)},extRadio:function(){return this._instance.options.radio},option:function(f,g){if(this.wasInit()&&!this.isLocked()){if((f=="radio")&&(g!=this.extRadio())){if(g){this._radioInit()}else{this._radioDone()}}}this._super(f,g)},_radioDone:function(f){this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");if(!f){this.radios(this.children(null,true,true)).each(this.proxy(function(g){this.setRadio(d(g),false)},true))}},_destroyHook:function(f){if(f){this._radioDone(true)}this._super(f)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(c,"aciTreeRadio");aciPluginClass.defaults("aciTree",a)})(jQuery,this);

// column
(function(d,b,e){var a={columnData:[]};var c={_initHook:function(){if(this._instance.options.columnData.length){var f=0,j=false,h;for(var g in this._instance.options.columnData){h=this._instance.options.columnData[g];if(h.width!==e){this._updateCss(".aciTree.aciTree"+this._instance.index+" .aciTreeColumn"+f,"width:"+h.width+"px;");j=true}f++}if(j){this._updateWidth()}}this._super()},_getCss:function(l,o,n){var g="_getCss_"+b.String(l).replace(/[^a-z0-9_-]/ig,"_");var k=d("body").find("#"+g);if(!k.length){if(l instanceof Array){var f="",h="";for(var j in l){f+='<div class="'+l[j]+'">';h+="</div>"}f+=h}else{var f='<div class="'+l+'"></div>'}d("body").append('<div id="'+g+'" style="position:relative;display:inline-block;width:0px;height:0px;line-height:0px;overflow:hidden">'+f+"</div>");k=d("body").find("#"+g)}var m=k.find("*:last").css(o);if(n){m=parseInt(m);if(isNaN(m)){m=null}}return m},_updateCss:function(h,f){var j="_updateCss_"+b.String(h).replace(">","_gt_").replace(/[^a-z0-9_-]/ig,"_");var g='<style id="'+j+'" type="text/css">'+h+"{"+f+"}</style>";var i=d("body").find("#"+j);if(i.length){i.replaceWith(g)}else{d("body").prepend(g)}},getWidth:function(f){if(f<this._instance.options.columnData.length){return this._getCss(["aciTree aciTree"+this._instance.index,"aciTreeColumn"+f],"width",true)}return null},setWidth:function(g,f){if(g<this._instance.options.columnData.length){this._updateCss(".aciTree.aciTree"+this._instance.index+" .aciTreeColumn"+g,"width:"+f+"px;");this._updateWidth()}},_updateWidth:function(){var f=0,j=0;for(var g in this._instance.options.columnData){if(this.isColumn(f)){j+=this.getWidth(f)}f++}var h=this._getCss(["aciTree","aciTreeIcon"],"width",true);j+=this._getCss(["aciTree","aciTreeItem"],"padding-left",true)+this._getCss(["aciTree","aciTreeItem"],"padding-right",true);this._updateCss(".aciTree.aciTree"+this._instance.index+" .aciTreeItem","margin-right:"+(h+j)+"px;");this._updateCss(".aciTree[dir=rtl].aciTree"+this._instance.index+" .aciTreeItem","margin-right:0;margin-left:"+(h+j)+"px;")},isColumn:function(f){if(f<this._instance.options.columnData.length){return this._getCss(["aciTree aciTree"+this._instance.index,"aciTreeColumn"+f],"display")!="none"}return false},toggleColumn:function(g,f){if(g<this._instance.options.columnData.length){if(f===e){var f=!this.isColumn(g)}this._updateCss(".aciTree.aciTree"+this._instance.index+" .aciTreeColumn"+g,"display:"+(f?"inherit":"none")+";");this._updateWidth()}},_itemHook:function(n,o,h,f){if(this._instance.options.columnData.length){var l=o.children(".aciTreeLine").find(".aciTreeEntry");var m=0,k,g;for(var j in this._instance.options.columnData){k=this._instance.options.columnData[j];g=this._createColumn(h,k,m);l.prepend(g);m++}}this._super(n,o,h,f)},_createColumn:function(f,h,g){var i=h.props&&(f[h.props]!==e)?f[h.props]:((h.value===e)?"":h.value);return d('<div class="aciTreeColumn aciTreeColumn'+g+'">'+(i.length?i:"&nbsp;")+"</div>")}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(c,"aciTreeColumn");aciPluginClass.defaults("aciTree",a)})(jQuery,this);

// editable (works best with selectable)
(function(c,b,e){var a={editable:false};var d={_initEditable:function(){this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(j,h,i,f,g){switch(f){case"blurred":var k=h.edited();if(k.length){h.edit(k,{edit:false,save:true})}break;case"unselected":if(h.isEdited(i)){h.edit(i,{edit:false,save:true})}break}}).bind("click"+this._private.nameSpace,this.proxy(function(){var f=this.edited();if(f.length){this.edit(f,{edit:false,save:true})}})).bind("keydown"+this._private.nameSpace,this.proxy(function(g){switch(g.which){case 113:if(this.extSelectable){var f=this.selected();if(!this.isEdited(f)){this.edit(f,{edit:true});g.preventDefault()}}break}})).on("mouseup"+this._private.nameSpace,".aciTreeItem",this.proxy(function(g){if(c(g.target).is(".aciTreeItem,.aciTreeText")){var f=this.itemFrom(g.target);if(this.extSelectable&&this.isSelected(f)){this.edit(f,{edit:true})}}})).on("dblclick"+this._private.nameSpace,".aciTreeItem",this.proxy(function(g){if(this.extSelectable&&!this.extSelectable()){var f=this.itemFrom(g.target);this.edit(f,{edit:true})}})).on("keydown"+this._private.nameSpace,"input[type=text]",this.proxy(function(g){switch(g.which){case 13:var f=this.itemFrom(g.target);this.edit(f,{edit:false,save:true});f.focus();g.stopPropagation();break;case 27:var f=this.itemFrom(g.target);this.edit(f,{edit:false});f.focus();g.stopPropagation();g.preventDefault();break;case 38:case 40:case 37:case 39:case 33:case 34:case 36:case 35:case 32:case 107:case 109:case 106:g.stopPropagation();break}})).on("blur"+this._private.nameSpace,"input[type=text]",this.proxy(function(){if(this.extSelectable&&!this.extSelectable()){var f=this.edited();this.edit(f,{edit:false,save:true})}})).on("click"+this._private.nameSpace+" dblclick"+this._private.nameSpace,"input[type=text]",function(f){f.stopPropagation()})},_initHook:function(){if(this.isEditable()){this._initEditable()}this._super()},_editbox:function(f){return f?f.children(".aciTreeLine").find("input[type=text]"):c([])},_addEditbox:function(g){var f=g.addClass("aciTreeEdited").children(".aciTreeLine");var h="editable_"+b.String(this.getId(g)).replace(/[^a-z0-9_-]/ig,"");f.find(".aciTreeText").html('<input id="'+h+'" type="text" value="" />');f.find("label").attr("for",h);this._editbox(g).val(this.getLabel(g))},_removeEditbox:function(g){var f=g.removeClass("aciTreeEdited").children(".aciTreeLine");f.find(".aciTreeText").html(this.getLabel(g));f.find("label").removeAttr("for")},edited:function(){return this._instance.jQuery.find(".aciTreeEdited:first")},isEdited:function(f){return f&&f.hasClass("aciTreeEdited")},_focusEdit:function(g){var h=this._editbox(g).focus().trigger("click").get(0);if(h){if(typeof h.selectionStart=="number"){h.selectionStart=h.selectionEnd=h.value.length}else{if(h.createTextRange!==e){var f=h.createTextRange();f.collapse(false);f.select()}}}},setLabel:function(g,f){f=this._options(f,function(i){if(this.isEditable()&&this.isEdited(i)){var h=this._editbox(i).is(":focus");this._addEditbox(i);if(h){this._focusEdit(i)}}});this._super(g,f)},edit:function(i,f){f=this._options(f,null,function(){this._trigger(i,"editfail",f)});if(this.isEditable()&&this.isItem(i)){if(!this._trigger(i,"beforeedit",f)){this._fail(i,f);return}var h=f.edit;var g=f.save;if(h&&this.isEdited(i)){if(g){var j=this._editbox(i).val();this.setLabel(i,{label:j})}this._trigger(k,"wasedit",f)}else{var k=this.edited();if(k.length){var j=this._editbox(k).val();this._removeEditbox(k);if(g){this.setLabel(k,{label:j})}this._trigger(k,"editstop",f)}if(h){if(this.extSelectable&&!this.isSelected(i)){this.select(i,{select:true})}this._addEditbox(i);this._focusEdit(i);this._trigger(i,"editstart",f)}}this._success(i,f)}else{this._fail(i,f)}},isEditable:function(){return this._instance.options.editable},option:function(f,g){if(this.wasInit()&&!this.isLocked()){if((f=="editable")&&(g!=this.isEditable())){if(g){this._initEditable()}else{this._doneEditable()}}}this._super(f,g)},_doneEditable:function(){this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.off(this._private.nameSpace,".aciTreeItem");this._instance.jQuery.off(this._private.nameSpace,"input[type=text]");var f=this.edited();if(f.length){this.edit(f,{edit:false,save:true})}},_destroyHook:function(f){if(f){this._doneEditable()}this._super(f)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(d,"aciTreeEditable");aciPluginClass.defaults("aciTree",a)})(jQuery,this);

// persist (require utils extension & jStorage plugin)
(function(c,b,e){var a={persist:null};var d={__extend:function(){c.extend(this._private,{selectTimeout:null,stateTimeout:null});this._super()},_initPersist:function(){this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(j,h,i,f,g){if(g.uid=="ui.persist"){return}switch(f){case"init":h._persistRestore();break;case"selected":h._persistLater(true);break;case"unselected":h._persistLater(true);break;case"opened":h._persistLater(false);break;case"closed":h._persistLater(false);break}})},_initHook:function(){if(this.extPersist()){this._initPersist()}this._super()},_persistLater:function(f){if(f){b.clearTimeout(this._private.selectTimeout);this._private.selectTimeout=b.setTimeout(this.proxy(function(){this._persistSelected()}),250)}else{b.clearTimeout(this._private.stateTimeout);this._private.stateTimeout=b.setTimeout(this.proxy(function(){this._persistOpen()}),250)}},_persistRestore:function(){var f=this._instance.queue;var j=c.jStorage.get("aciTree_"+this._instance.options.persist+"_opened");if(j instanceof Array){for(var g in j){(function(i){f.push(function(k){this.searchId(null,null,{success:function(l){this.open(l,{uid:"ui.persist",success:k,fail:k})},fail:k,id:i})})})(j[g])}}if(this.extSelectable){var h=c.jStorage.get("aciTree_"+this._instance.options.persist+"_selected");if(h){f.push(function(i){this.searchId(null,null,{success:function(k){this.select(k,{uid:"ui.persist",success:function(l){this.setVisible(l,{center:true});i()},fail:i,select:true})},fail:i,id:h})})}}},_persistSelected:function(){if(this.extSelectable){var f=this.selected();c.jStorage.set("aciTree_"+this._instance.options.persist+"_selected",this.getId(f))}},_persistOpen:function(){var f=[];this.visible(this.inodes(this.children(null,true),true)).each(this.proxy(function(g){f[f.length]=this.getId(c(g))},true));c.jStorage.set("aciTree_"+this._instance.options.persist+"_opened",f)},isPersist:function(){if(this.extPersist()){var f=c.jStorage.get("aciTree_"+this._instance.options.persist+"_selected");if(f){return true}var g=c.jStorage.get("aciTree_"+this._instance.options.persist+"_opened");if(g instanceof Array){return true}}return false},unpersist:function(){if(this.extPersist()){c.jStorage.deleteKey("aciTree_"+this._instance.options.persist+"_selected");c.jStorage.deleteKey("aciTree_"+this._instance.options.persist+"_opened")}},extPersist:function(){return this._instance.options.persist},option:function(f,h){var g=this.extPersist();this._super(f,h);if(this.extPersist()!=g){if(g){this._donePersist()}else{this._initPersist()}}},_donePersist:function(){this._instance.jQuery.unbind(this._private.nameSpace)},_destroyHook:function(f){if(f){this._donePersist()}this._super(f)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(d,"aciTreePersist");aciPluginClass.defaults("aciTree",a)})(jQuery,this);

// hash (require utils extension & aciFragment plugin)
(function(d,c,e){var a={selectHash:null,openHash:null};var b={__extend:function(){d.extend(this._private,{lastSelect:null,lastOpen:null,hashApi:null});this._super()},_initHash:function(){this._instance.jQuery.aciFragment();this._private.hashApi=this._instance.jQuery.aciFragment("api");this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(j,h,i,f,g){switch(f){case"init":h._hashRestore();break}}).bind("acifragment"+this._private.nameSpace,this.proxy(function(h,g,f){h.stopPropagation();this._hashRestore()}))},_initHook:function(){if(this.extHast()){this._initHash()}this._super()},_hashRestore:function(){var f=this._instance.queue;var i=function(l){for(var k in l){(function(m){f.push(function(n){this.searchId(null,null,{success:function(o){this.open(o,{uid:"ui.hash",success:n,fail:n})},fail:n,id:m})})})(l[k])}};if(this._instance.options.openHash){var h=this._private.hashApi.get(this._instance.options.openHash,"");if(h.length&&(h!=this._private.lastOpen)){this._private.lastOpen=h;var j=h.split(";");i(j)}}if(this._instance.options.selectHash&&this.extSelectable){var h=this._private.hashApi.get(this._instance.options.selectHash,"");if(h.length&&(h!=this._private.lastSelect)){this._private.lastSelect=h;var j=h.split(";");var g=j.pop();i(j);if(g){f.push(function(k){this.searchId(null,null,{success:function(l){this.select(l,{uid:"ui.hash",success:function(m){this.setVisible(m,{center:true});k()},fail:k,select:true})},fail:k,id:g})})}}}},extHast:function(){return this._instance.options.selectHash||this._instance.options.openHash},option:function(f,g){var h=this.extHast();this._super(f,g);if(this.extHast()!=h){if(h){this._doneHash()}else{this._initHash()}}},_doneHash:function(){this._instance.jQuery.unbind(this._private.nameSpace);this._private.hashApi=null;this._instance.jQuery.aciFragment("destroy")},_destroyHook:function(f){if(f){this._doneHash()}this._super(f)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(b,"aciTreeHash");aciPluginClass.defaults("aciTree",a)})(jQuery,this);

// sortable (require utils extension & aciSortable plugin)
(function(d,c,e){var a={sortable:false,sortDrag:function(g,i,h,f){if(!h){f.html(this.getLabel(g))}},sortValid:function(i,g,j,f,k,h){if(f){h.html("move "+this.getLabel(i)+" to "+this.getLabel(this.itemFrom(g)));k.removeClass("aciTreeAfter aciTreeBefore")}else{if(j!==null){if(j){h.html("move "+this.getLabel(i)+" before "+this.getLabel(g));k.removeClass("aciTreeAfter").addClass("aciTreeBefore")}else{h.html("move "+this.getLabel(i)+" after "+this.getLabel(g));k.removeClass("aciTreeBefore").addClass("aciTreeAfter")}}}}};var b={__extend:function(){d.extend(this._private,{openTimeout:null});this._super()},_initSortable:function(){this._instance.jQuery.aciSortable({container:".aciTreeUl",item:".aciTreeLi",child:50,childHolder:'<ul class="aciTreeUl aciTreeChild"></ul>',childHolderSelector:".aciTreeChild",placeholder:'<li class="aciTreeLi aciTreePlaceholder"><div></div></li>',placeholderSelector:".aciTreePlaceholder",helper:'<div class="aciTreeHelper"></div>',helperSelector:".aciTreeHelper",before:this.proxy(function(g){this._instance.jQuery.focus();var f=this._options();if(!this._trigger(g,"beforedrag",f)){this._trigger(g,"dragfail",f);return false}return true}),start:this.proxy(function(g,h,f){this._instance.jQuery.addClass("aciTreeDragDrop");f.css({opacity:1}).html(this.getLabel(g))}),drag:this.proxy(function(g,i,h,f){if(!h){c.clearTimeout(this._private.openTimeout)}if(this._instance.options.sortDrag){this._instance.options.sortDrag.apply(this,arguments)}}),valid:this.proxy(function(j,h,k,g,l,i){c.clearTimeout(this._private.openTimeout);if(!g&&this.isInode(h)){if(!this.isOpen(h)&&!h.data("opening"+this._private.nameSpace)){this._private.openTimeout=c.setTimeout(this.proxy(function(){h.data("opening"+this._private.nameSpace,true);this.open(h,{success:function(m){m.removeData("opening"+this._private.nameSpace)},fail:function(m){m.removeData("opening"+this._private.nameSpace)}})}),1000)}}var f=this._options({hover:h,before:k,isContainer:g,placeholder:l,helper:i});if(!this._trigger(j,"checkdrop",f)){return false}if(this._instance.options.sortValid){this._instance.options.sortValid.apply(this,arguments)}return true}),create:this.proxy(function(g,h,f){if(this.isLeaf(f)){f.append(g._instance.options.childHolder);return true}return false},true),end:this.proxy(function(p,k,n,g){c.clearTimeout(this._private.openTimeout);var q={placeholder:n,helper:g};q=this._options(q,function(){this._trigger(p,"sorted",q)},function(){this._trigger(p,"dropfail",q)});if(n.parent().length){var i=this.prev(n,true);if(i.length){n.detach();this.moveAfter(p,this._inner(q,{success:q.success,fail:q.fail,after:i}))}else{var j=this.next(n,true);if(j.length){n.detach();this.moveBefore(p,this._inner(q,{success:q.success,fail:q.fail,before:j}))}else{var o=this.parent(n);var f=n.parent();n.detach();f.remove();if(this.isLeaf(o)){this.asChild(p,this._inner(q,{success:function(){this._success(p,q);this.open(o)},fail:q.fail,parent:o}))}else{this._fail(p,q)}}}}else{this._fail(p,q)}if(g.parent().length){var m=d(c).scrollTop();var h=d(c).scrollLeft();var l=p.get(0).getBoundingClientRect();g.animate({top:l.top+m,left:l.left+h,opacity:0},{complete:function(){g.detach()}})}this._instance.jQuery.removeClass("aciTreeDragDrop")})})},_initHook:function(){if(this.extSortable()){this._initSortable()}this._super()},extSortable:function(){return this._instance.options.sortable},option:function(f,g){if(this.wasInit()&&!this.isLocked()){if((f=="sortable")&&(g!=this.extSortable())){if(g){this._initSortable()}else{this._doneSortable()}}}this._super(f,g)},_doneSortable:function(){this._instance.jQuery.unbind(this._private.nameSpace);this._instance.jQuery.aciSortable("destroy")},_destroyHook:function(f){if(f){this._doneSortable()}this._super(f)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(b,"aciTreeSortable");aciPluginClass.defaults("aciTree",a)})(jQuery,this);
